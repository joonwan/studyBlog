
---

## 준영속 엔티티란?

- 영속성 컨텍스트가 더는 관리하지 않는 엔티티를 의미한다.
- 영속성 컨텍스트에 한번이라도 들어갔다가 나온 엔티티를 의미한다.
- DB에 식별자 생성을 위임하고 DB에 한번저장된 경우 JPA가 식별할 수 있는 아이디를 가지고 있다.
- 하지만 영속성 컨텍스트에서 관리하지 않고 있는 준 영속 엔티티는 아무리 변경해도 저장 로직이 없으면 DB에 변경이 반영되지 않는다.
- 따라서 준영속 엔티티를 수정하는 방법을 알아보자

## 준영속 엔티티를 수정하는 2가지 방법

- dirty checking
- merge (병합)

## 변경 감지 기능 사용 - dirty checking

```java
@Transactional  
public void updateItem(Long itemId, Book param){  
Item findItem = repository.findOne(itemId);  
findItem.setPrice(param.getPrice());  
findItem.setName(param.getName());  
findItem.setStockQuantity(param.getStockQuantity());  
}
```

- 준 영속 상태인 엔티티를 DB에서 조회하면 먼저 결과를 영속성 컨텍스트에 저장한 후 Client 에게 반환한다.
- 따라서 상태는 준 영속에서 영속상태로 전환된다.
- 이로인해 이 엔티티는 dirty checking 이 가능해 진다.
- 따라서 로직 실행 후 flush 시점에 변경 된 값들이 DB에 반영된다.

## 병합 기능 사용 - Merge

```Java
	em.merge(Entity entity);
```

- merge 를 사용할 경우 엔티티의 식별자를 영속성 컨텍스트 또는 DB에서 찾는다.
- Parameter로 넘어온 Entity의 값으로 기존 엔티티의 필드 값을 바꿔치기 한다.
- 즉 변경 감지 기능 사용에서 사용한 코드를 merge() 가 